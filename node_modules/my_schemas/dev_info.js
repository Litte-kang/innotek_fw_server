var mongoose = require('../../innotek_device_fw_db');
var Schema = mongoose.Schema;


var schema = new Schema({
	myDeviceType:Number,
	addressName:String,
	myId:String,
	slaveDeviceType:Number,
	hostId:String,
	version:String,
	updateAt:Date
});

var DevInfo = mongoose.model('device_infos', schema);

module.exports.insert = function(cmds)
{

	console.log(cmds);	
};

module.exports.getDevInfos = function(index, slaveDevType, res)
{
	var opt;

	if ('null' === slaveDevType)
	{
		opt = {myDeviceType:Number(index)};
	}
	else
	{
		opt = {myDeviceType:slaveDevType,hostId:index};
	}

	DevInfo.find(opt, function(err, infos){


		res.setHeader('Content-Type', 'application/string');

		if (err)
		{
			console.log("not exist device information");
			res.writeHead(404);
			res.write("[]");	
		}
		else
		{
			console.log(infos);
			res.writeHead(200);	
			res.write(JSON.stringify(infos));
		}

		res.end();
	});
};