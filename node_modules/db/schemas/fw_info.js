var Mongoose = require('../db');
var Schema = Mongoose.Schema;

var schema = new Schema({
	fwType:Number,
	info:String,
	version:String,
	fwSize:Number,
	createAt:String
});

var FwInfo = Mongoose.InnotekDevFwDb.model('fw_infos', schema);

module.exports.insertFwInfo = function(info, res)
{

	console.log(info);

	FwInfo.findOneAndUpdate({fwType:info.fwType, version:info.version}, info, {upsert: true}, function(err, data){
						   
    	if (err)
        {
            res.writeHead(404);
            res.end();    			    			
    	}
        else
        {    		
    		res.writeHead(200);
            res.end();;
    	}
 	});	
};

module.exports.getFwInfos = function(params, res)
{
	if (params.version)
	{
		FwInfo.find({fwType:params.fwType})
		.sort({version:1})
		.where('version').gt(params.version)
		.limit(3)
		.exec(function(err, data){

			if (err)
			{
				res.writeHead(404);
				res.write("[]");			
			}
			else
			{
				console.log(data);
				res.writeHead(200);
				res.write(JSON.stringify(data));
			}

			res.end();

		});		
	}
	else
	{
		FwInfo.find({fwType:params.fwType}, function(err, data){

			if (err)
			{
				res.writeHead(404);
				res.write("[]");			
			}
			else
			{
				console.log(data);
				res.writeHead(200);
				res.write(JSON.stringify(data));
			}

			res.end();			
		});
	}

};

module.exports.FwInfo = FwInfo;

















