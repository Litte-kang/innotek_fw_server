var Mongoose = require('../db');
var Schema = Mongoose.Schema;

var schema = new Schema({
	fwType:Number,
	info:String,
	version:String,
	fwSize:Number,
	createAt:String
});

var FwInfo = Mongoose.InnotekDevFwDb.model('fw_infos', schema);

module.exports.insertFwInfo = function(info, res)
{

	var json = JSON.parse(info);

	console.log(json);

	FwInfo.findOneAndUpdate({fwType:json.fwType, version:json.version}, json, {upsert: true}, function(err, data){
						   
    	if (err)
        {
            res.writeHead(404);
            res.write("失败");
            res.end();    			    			
    	}
        else
        {    		
    		res.writeHead(200);
            res.write("成功");
            res.end();;
    	}
 	});	
};

module.exports.getFwInfos = function(type, res)
{
	FwInfo.find({fwType:type}, function(err, data){

		if (err)
		{
			res.writeHead(404);
			res.write("[]");			
		}
		else
		{
			console.log(data);
			res.writeHead(200);
			res.write(JSON.stringify(data));
		}

		res.end();
	});
};

module.exports.FwInfo = FwInfo;

















